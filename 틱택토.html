<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>틱택토</title>

		<style>
			* {
				padding: 0;
				margin: 0;
				box-sizing: border-box;
			}
			ul {
				list-style: none;
			}

			main {
				margin: 50px auto 0;
				padding: 30px;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			h1 {
				font-size: 28px;
				margin-bottom: 10px;
			}

			.noti {
				padding-left: 20px;
				margin-bottom: 30px;
			}
			.noti li {
				font-size: 13px;
				color: #666;
				line-height: 1.2;
			}

			.button_wrap {
				display: flex;
				justify-content: flex-start;
				align-items: center;
				gap: 20px;
				margin-bottom: 30px;
			}
			.button_wrap button {
				width: 80px;
				height: 40px;
				font-size: 24px;
				cursor: pointer;
			}
			.button_wrap li {
				font-size: 20px;
				font-weight: bold;
			}
			.button_wrap #player {
				font-size: 28px;
				color: tomato;
			}

			table {
				width: 500px;
				height: 500px;
				display: flex;
				flex-direction: column;
				gap: 10px;
			}
			table tr {
				width: 100%;
				height: calc((100% - 20px) / 3);
				display: flex;
				gap: 10px;
			}
			table tr td {
				width: calc((100% - 20px) / 3);
				height: 100%;
				font-size: 100px;
				display: flex;
				justify-content: center;
				align-items: center;
				background-color: #ddd;
				cursor: pointer;
				transition: 0.4s;
			}
			table tr td:hover {
				background-color: #eee;
			}
		</style>
	</head>
	<body>
		<main>
			<h1>틱택토</h1>

			<ol class="noti">
				<li>먼저 시작할 Player를 선택해 주세요.(O/X)</li>
				<li>
					가로, 세로, 대각선으로 이어진 3칸을 먼저 완성한 사람이 승리합니다.
				</li>
			</ol>

			<ul class="button_wrap">
				<li><button>O</button></li>
				<li><button>X</button></li>
				<li>Player : <span id="player"></span></li>
			</ul>
		</main>

		<script>
			const $main = document.querySelector("main");
			const $playerBtnWrap = document.querySelector(".button_wrap");
			const $player = document.querySelector("#player");

			const fieldArr = Array.from(Array(3), () => Array(3).fill(null));
			let player;
			let isGameStarted = false;

			function updateGameField() {
				const $prevTable = document.querySelector("table");

				if ($prevTable !== null) {
					$prevTable.remove();
				}
				const $table = document.createElement("table");

				for (let i = 0; i < fieldArr.length; i++) {
					const $tr = document.createElement("tr");

					for (let j = 0; j < fieldArr[i].length; j++) {
						const $td = document.createElement("td");
						$td.setAttribute("data-id", `${i}${j}`);
						if (fieldArr[i][j] !== null) {
							$td.textContent = fieldArr[i][j];
						}

						$tr.append($td);
					}
					$table.append($tr);
				}

				$main.append($table);
			}

			function finishGame(tie) {
				if (tie) {
					console.log("무승부");
				} else {
					console.log(`${player}승리!`);
				}
				updateGameField();
				return;
			}

			$playerBtnWrap.addEventListener("click", (e) => {
				const target = e.target.nodeName;

				if (target !== "BUTTON" || isGameStarted) {
					return;
				}
				player = e.target.innerText;
				$player.textContent = player;
			});

			$main.addEventListener("click", (e) => {
				const target = e.target;

				if (target.nodeName !== "TD" || player === undefined) {
					return;
				}
				isGameStarted = true;
				const targetId = target.getAttribute("data-id").split("");
				const trIdx = targetId[0];
				const tdIdx = targetId[1];

				if (fieldArr[trIdx][tdIdx] !== null) {
					return;
				}
				fieldArr[trIdx][tdIdx] = player;
				target.textContent = player;

				if (fieldArr[trIdx][tdIdx] === null) {
					return;
				}

				let diagnal = [];
				const diagnal2 = [];

				for (let i = 0; i < fieldArr.length; i++) {
					const row = [];
					const column = [];

					for (let j = 0; j < fieldArr[i].length; j++) {
						// 가로줄 확인
						fieldArr[i][j] === player ? row.push(true) : row.push(false);

						// 세로줄 확인
						fieldArr[j][i] === player ? column.push(true) : column.push(false);
					}

					// 대각선 확인
					fieldArr[i][i] === player ? diagnal.push(true) : diagnal.push(false);

					if (!row.includes(false) || !column.includes(false)) {
						finishGame(false);
					}
				}

				// 대각선 확인2
				const diagLine = [fieldArr[0][2], fieldArr[1][1], fieldArr[2][0]];

				diagLine.forEach((val) => {
					val === player ? diagnal2.push(true) : diagnal2.push(false);
				});

				if (!diagnal2.includes(false) || !diagnal.includes(false)) {
					finishGame(false);
				} else if (
					!fieldArr[0].includes(null) &&
					!fieldArr[1].includes(null) &&
					!fieldArr[2].includes(null)
				) {
					finishGame(true);
				}

				// player 교체
				if (player === "O") {
					player = "X";
				} else if (player === "X") {
					player = "O";
				}
				$player.textContent = player;
			});

			window.onload = () => {
				updateGameField();
			};
		</script>
	</body>
</html>
